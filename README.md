# Документация
Данное приложение представляет из себя RESTful API для создания онлайн опросов.

## Инструкция по разворачиванию

1. Откройте терминал
2. Выполните команду
```bash
git clone https://github.com/dominon12/SurveyAPI.git
```
3. Перейдите в папку
```bash
cd SurveyAPI
```
4. Созздайте виртуальное окружение и активируйте его
```bash
python3 -m venv venv
source venv/bin/activate
```
5. Установите зависимости
```bash
pip install -r requirements.txt
```

6. Создайте миграции и мигрируйте базу данных
```bash
python manage.py makemigrations
python manage.py migrate
python manage.py migrate --run-syncdb
```

7. Создайте суперпользователя
```bash
python manage.py createsuperuser
```

8. Запустите локальный сервер
```bash
python manage.py runserver
```

## Документация

#### Базовый URL - /api/v0.1/

- Все данные отправляемые с помощью HTTP-запросов должны быть в формате JSON
- Для доступа к некоторым API ендпоинтам необходима пройти аутентификацию
(Ендпоинты для которых она нужна, будут помечены в данной документацией символом "*")

### 1. Аутентификация
url - /api/v0.1/accounts/auth/
HTTP метод - POST

тело запроса:
```json
{
    "username": "username",
    "password": "password"
}
```
Пример ответа с сервера:
```json
{
    "token": "73b0a4df6a3acfcd6dd63b1fa8827e7342dd91a2"
}
```

В последствии полученный токен необходимо прикладывать в заголовок к каждым запросам, помеченным символом "*" в документации

Пример заголовка:
```json
{
    "Authorization": "Token 73b0a4df6a3acfcd6dd63b1fa8827e7342dd91a2"
}
```

## Создание опроса *
url - /api/v0.1/surveys/create/
HTTP метод - POST

В теле запроса необходимо указать поля:
- name (имя опроса) - строка длиной до 150 символов
- description (описание) - строка любой длины
- questioins - массив из вопросос. В каждом объекте вопроса должны быть указаны поля:
    -- text (сам вопрос) - строка любой длины
    -- question_type (тип вопроса) - целое число от 1 до 3 (1 - ответ текстом, 2 - ответ с выбором одного варианта, 3 - ответ с выбором нескольких вариантов)

Пример тела запроса:
```json
{
    "name": "Название опроса", 
    "description": "Описание опроса", 
    "questions": [
        {
            "text": "Текст вопроса 1",
            "question_type": 1
        },
        {
            "text": "Текст вопроса 2",
            "question_type": 2
        }
    ]
}
```
Пример ответа с сервера:
```json
{
    "pk": 5,
    "name": "Название опроса",
    "description": "Описание опроса",
    "date_started": "2021-02-11T17:41:40.739003Z",
    "date_ended": null,
    "questions": [
        {
            "pk": 5,
            "text": "Текст вопроса 1",
            "question_type": 1
        },
        {
            "pk": 6,
            "text": "Текст вопроса 2",
            "question_type": 2
        }
    ]
}
```

## Изменение опроса *
url - /api/v0.1/surveys/<pk>/update/
HTTP метод - PUT
* вместо <pk> в url выше необходимо подставить pk опроса, который необходимо изменить

Данный ендпоинт используется для изменение (частичного или полного) данных самого опроса (но не вопросов опроса)

Пример тела запроса:
```json
{
    "name": "Изменённое название опроса", 
    "description": "Изменённое описание опроса", 
    "questions": [
        {
            "text": "Текст вопроса 1",
            "question_type": 1
        },
        {
            "text": "Текст вопроса 2",
            "question_type": 2
        }
    ]
}
```
Пример ответа с сервера:
```json
{
    "pk": 5,
    "name": "Изменённое название опроса",
    "description": "Изменённое описание опроса",
    "date_started": "2021-02-11T17:41:40.739003Z",
    "date_ended": null,
    "questions": [
        {
            "pk": 5,
            "text": "Текст вопроса 1",
            "question_type": 1
        },
        {
            "pk": 6,
            "text": "Текст вопроса 2",
            "question_type": 2
        }
    ]
}
```

## Удаление опроса *
url - /api/v0.1/surveys/<pk>/destroy/
HTTP метод - DELETE
* вместо <pk> в url выше необходимо подставить pk опроса, который необходимо изменить

Данный ендпоинт используется для удаления опроса (также будут удалены и вопросы опроса)

Тело запроса - отсутствует
Ответ с сервера - 204 

## Получение списка активных опросов
url - /api/v0.1/surveys/list/
HTTP метод - GET

Тело запроса - отсутствует

Пример ответа с сервера:
```json
[
    {
        "pk": 5,
        "name": "Изменённое название опроса",
        "description": "Изменённое описание опроса",
        "date_started": "2021-02-11T17:41:40.739003Z",
        "date_ended": null,
        "questions": [
            {
                "pk": 5,
                "text": "Текст вопроса 1",
                "question_type": 1
            },
            {
                "pk": 6,
                "text": "Текст вопроса 2",
                "question_type": 2
            }
        ]
    }
]
```


## Создание вопроса *
url - /api/v0.1/surveys/questions/create/
HTTP метод - POST

В теле запроса необходимо указать поля:

- survey (pk опроса для которого необходимо создать вопрос) - целое число
- text (сам вопрос) - строка любой длины
- question_type (тип вопроса) - целое число от 1 до 3 (1 - ответ текстом, 2 - ответ с выбором одного варианта, 3 - ответ с выбором нескольких вариантов)

Пример тела запроса:
```json
{
    "survey": 5,
    "text": "Текст вопроса 3",
    "question_type": 3
}
```
Пример ответа с сервера:
```json
{
    "pk": 7,
    "text": "Текст вопроса 3",
    "question_type": 3,
    "survey": 5
}
```

## Изменение вопроса *
url - /api/v0.1/surveys/questions/<pk>/update/
HTTP метод - PUT
* вместо <pk> в url выше необходимо подставить pk вопроса, который необходимо изменить

Данный ендпоинт используется для изменение (частичного или полного) данных вопроса

Пример тела запроса:
```json
{
    "text": "Измененный текст вопроса 3",
    "question_type": 2
}
```
Пример ответа с сервера:
```json
{
    "pk": 7,
    "text": "Измененный текст вопроса 3",
    "question_type": 2,
    "survey": 5
}
```

## Удаление вопроса *
url - /api/v0.1/surveys/questions/<pk>/destroy/
HTTP метод - DELETE
* вместо <pk> в url выше необходимо подставить pk вопроса, который необходимо изменить

Данный ендпоинт используется для удаления вопроса

Тело запроса - отсутствует
Ответ с сервера - 204 

## Прохождение опроса пользователем
url - /api/v0.1/surveys/completed/create/
HTTP метод - POST

В теле запроса необходимо указать поля:
- survey (pk опроса) - целое число
- user_id (id пользователя) - целое число
- answers - массив из объектов ответа. В каждом объекте ответа должны быть указаны поля:
    -- question (pk вопроса) - целое число
    -- answer (ответ пользователя на вопрос) - строка любой длины

Пример тела запроса:
```json
{
    "survey": 5,
    "user_id": 1,
    "answers": [
        {
            "question": 5,
            "answer": "Ответ пользователя"
        }
    ]
}
```
Пример ответа с сервера:
```json
{
    "survey": 5,
    "user_id": 1,
    "answers": [
        {
            "question": 5,
            "answer": "Ответ пользователя"
        }
    ]
}
```

## Получение пройденных пользователем опросов с детализацией по ответам 
url - /api/v0.1/surveys/completed/<user_id>/
HTTP метод - GET
*вместо <user_id> в url необходимо подставить id пользователя

Пример ответа с сервера:
```json
[
    {
        "survey": 5,
        "user_id": 1,
        "answers": [
            {
                "question": 5,
                "answer": "Ответ пользователя"
            }
        ]
    }
]
```

**Конец документации.**